<!DOCTYPE html>
<html lang="en">
<head>
  <title>MULTI TRANSACTION QUEUING</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../../assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="../../assets/css/font-awesome.min.css">
  <script src="../../assets/js/jquery.min.js"></script>
  <script src="../../assets/js/bootstrap.min.js"></script>
  <script src="../../assets/js/chart.min.js"></script>
  <script type="text/javascript">
    function startTime() {
      var today = new Date();

      var months = ["January","February","March","April","May","June","July","August","September","October","November","December"];

      var month_ = months[today.getMonth()];
      var date_ = today.getDate();
      var year_ = today.getFullYear();

      var h = today.getHours();
      var m = today.getMinutes();
      var s = today.getSeconds();
      m = checkTime(m);
      s = checkTime(s);

      var hour_ = h - (h >= 12 ? 12 : 0);
      var period = h >= 12 ? 'PM' : 'AM';
      document.getElementById('date-txt').innerHTML = month_ + " " + date_ + ", " +year_;
      document.getElementById('time-txt').innerHTML = hour_ + ":" + m + " " +period;
      var t = setTimeout(startTime, 500);
    }
    function checkTime(i) {
      if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
      return i;
    }
  </script>
</head>
<body onload='startTime()'>
  <div class="well text-center" style='background-color:#049408;color:#fff;'>
    <h3 style="margin: auto;">MULTI TRANSACTION QUEUING SYSTEM</h3>
    <h4 style="margin: auto;"><span id="date-txt"></span> <span id="time-txt"></span></h4>
  </div>
  <div class="container" style="margin: auto;width:80%;">
    <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#home" onclick="getCounter()">COUNTER</a></li>
        <li><a data-toggle="tab" href="#menu1" onclick="getLine()">REPORT</a></li>
    </ul>

    <div class="tab-content">
        <div id="home" class="tab-pane fade in active">
        <h3>
            Counters
            <button type="button" class="btn btn-primary" style="float: right;" onclick="newTellerModal()">
              <span class="fa fa-plus-circle"></span> New Counter
            </button>
        </h3>
        <table class="table">
            <thead class="thead-dark">
                <tr style='background-color:green;color:#fff;'>
                    <th scope="col">#</th>
                    <th scope="col">Counter Name</th>
                    <th scope="col">Username</th>
                    <th scope="col">Action</th>
                </tr>
            </thead>
            <tbody id="teller-content">
            </tbody>
        </table>

        </div>
        <div id="menu1" class="tab-pane fade">
          <h3>Annual Report of Customers (2020)</h3>
          <div class="col-md-10">
            <canvas id="lineChart"></canvas>
          </div>
        </div>
    </div>
  </div>
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Add New Counter Modal</h4>
        </div>
        <div class="modal-body">
          <div class="input-group" style='margin-bottom:2px;'>
            <span class="input-group-addon"><i class="fa fa-user"></i></span>
            <input type="text" class="form-control" id="teller_name" placeholder="Counter Name">
          </div>
          <div class="input-group" style='margin-bottom:2px;'>
            <span class="input-group-addon"><i class="fa fa-user"></i></span>
            <input type="text" class="form-control" id="username" placeholder="Username">
          </div>
          <div class="input-group" style='margin-bottom:2px;'>
            <span class="input-group-addon"><i class="fa fa-key"></i></span>
            <input type="password" class="form-control" id="password" placeholder="Password">
          </div>
          <p style="color: red;"><strong id="res"></strong></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-success" id="btn-add" onclick='newTeller()'> Add Counter</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
</body>
<script type="text/javascript">
  getCounter();
  function getCounter(){
    $.post("../ajax/controller_get_teller.php",{
    },function(data,status){
      $("#teller-content").html(data);
    });
  }
  function changeTeller(teller_id,ele){
    var teller_name = ele.innerHTML;
    $.post("../ajax/controller_update_teller.php",{
      teller_id:teller_id,
      teller_name:teller_name
    },function(data,status){
      // alert(data);
      getCounter();
      if(data == 1){
      }else if(data == -1){
        alert("Sorry, counter name already exist");
      }else{
        alert("Sorry, error occur");
      }
    });
  }
  function newTellerModal(){
    $("#teller_name").val('');
    $("#username").val('');
    $("#password").val('');
    $("#myModal").modal('show');
  }
  function newTeller(){
    var teller_name = $("#teller_name").val();
    var username = $("#username").val();
    var password = $("#password").val();

    if (teller_name == '') {
      $("#res").html('<span class="fa fa-exclamation-circle"></span> Please input Teller Name');
      $("#teller_name").focus();
    }else if (username == ''){
      $("#username").focus();
      $("#res").html('<span class="fa fa-exclamation-circle"></span> Please input Username');
    }else if (password == ''){
      $("#password").focus();
      $("#res").html('<span class="fa fa-exclamation-circle"></span> Please input Password');
    }else{
      $("#btn-add").prop('disabled',true);
      $("#btn-add").html("<span class='fa fa-spin fa-spinner'></span> Loading");
      $.post("../ajax/controller_add_teller.php",{
        teller_name:teller_name,
        username:username,
        password:password
      },function(data,status){
        getCounter();
        if(data == -1){
          $("#res").html('<span class="fa fa-exclamation-circle"></span> Counter Name already exists');
          $("#teller_name").focus();
        }else if(data == -2){
          $("#res").html('<span class="fa fa-exclamation-circle"></span> Username already exists');
          $("#username").focus();
        }else if(data == 1){
          $("#myModal").modal('hide');
        }else{
          $("#myModal").modal('hide');
          alert("error 500");
        }
        $("#btn-add").prop('disabled',false);
        $("#btn-add").html(" Add Counter");
      });
    }
  }
  function deleteTeller(teller_id){
    var is_confirm = confirm("Are you sure to delete this counter?");
    if(is_confirm == true){
      $.post("../ajax/controller_delete_teller.php",{
        teller_id:teller_id
      },function(data,status){
        getCounter();
        if(data == 1){
          alert("Teller succesfully deleted");
        }else{
          alert("Sorry, error occur");
        }
      });
    }
  }

  function getLine(){
    $.getJSON("../ajax/controller_get_report.php",{
    },function(data,status){
      var ctxL = document.getElementById("lineChart").getContext('2d');
      var myLineChart = new Chart(ctxL, {
        type: 'line',
        data: data,
        options: {
        responsive: true
        }
      });
    });
  }
</script>
</html>